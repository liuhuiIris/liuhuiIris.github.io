<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="liuhuiIris">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="liuhuiIris">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="liuhuiIris">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>liuhuiIris</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">liuhuiIris</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/04/Clamav病毒防护软件安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/04/Clamav病毒防护软件安装/" itemprop="url">Clamav病毒防护软件安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-04T10:05:17+08:00">
                2018-12-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考网站：<a href="http://www.clamav.net/documents/installing-clamav#rhel" target="_blank" rel="noopener">http://www.clamav.net/documents/installing-clamav#rhel</a></p>
<h1 id="1-On-CentOS"><a href="#1-On-CentOS" class="headerlink" title="1. On CentOS:"></a>1. On CentOS:</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> yum install -y epel-release</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> yum install -y clamav</span><br></pre></td></tr></table></figure>
<p>On Community Enterprise Operating System (CentOS) the clamav package requires the Extra Packages for Enterprise Linux (EPEL) repository. On RedHat Enterprise Linux (RHEL) the EPEL release package has to be installed either manually or through RHN.</p>
<h1 id="2-Run-command-to-test"><a href="#2-Run-command-to-test" class="headerlink" title="2. Run command to test"></a>2. Run command to test</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> clamscan /tmp</span><br></pre></td></tr></table></figure>
<h1 id="3-Questions"><a href="#3-Questions" class="headerlink" title="3. Questions"></a>3. Questions</h1><p>If there are some errors like this:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"LibClamAV Error: cli_loaddbdir(): No supported database files found in /var/lib/clamav</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ERROR: Can't open file or directory"</span></span><br></pre></td></tr></table></figure></p>
<p>You need to install some package to /var/lib/clamav</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /var/lib/clamav</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget db.local.clamav.net/main.cvd</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget db.local.clamav.net/daily.cvd</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> wget db.local.clamav.net/bytecode.cvd</span></span><br></pre></td></tr></table></figure>
<p>And then run the command again to test<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> clamscan /tmp</span></span><br></pre></td></tr></table></figure></p>
<h1 id="4-Done"><a href="#4-Done" class="headerlink" title="4. Done"></a>4. Done</h1><p>You can see the message, then done!<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@znywhost clamav]# clamscan /tmp</span><br><span class="line"></span><br><span class="line">/tmp/cloudwiz-user-stdout---supervisor-ks4Nv4.log: OK</span><br><span class="line">/tmp/mysql-stdout---supervisor-9nkIv0.log: OK</span><br><span class="line">/tmp/mysql-stderr---supervisor-DPkog8.log: OK</span><br><span class="line">/tmp/opentsdb-stdout---supervisor-Pe5q7f.log.1: OK</span><br><span class="line">/tmp/opentsdb-stdout---supervisor-Pe5q7f.log: OK</span><br><span class="line">/tmp/umanager-stderr---supervisor-mgzixe.log: OK</span><br><span class="line">/tmp/permission-stdout---supervisor-Y2Bhvy.log: OK</span><br><span class="line">/tmp/webfront-stderr---supervisor-IN1WLq.log: OK</span><br><span class="line">/tmp/kafka-stdout---supervisor-AdqhYG.log: OK</span><br><span class="line">/tmp/umanager-stdout---supervisor-cxCgc_.log: OK</span><br><span class="line">/tmp/zookeeper-stdout---supervisor-bZQngQ.log: OK</span><br><span class="line"></span><br><span class="line">----------- SCAN SUMMARY -----------</span><br><span class="line">Known viruses: 6727830</span><br><span class="line">Engine version: 0.100.2</span><br><span class="line">Scanned directories: 1</span><br><span class="line">Scanned files: 11</span><br><span class="line">Infected files: 0</span><br><span class="line">Data scanned: 48.80 MB</span><br><span class="line">Data read: 166.54 MB (ratio 0.29:1)</span><br><span class="line">Time: 34.632 sec (0 m 34 s)</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/30/rsyslog收集日志/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/30/rsyslog收集日志/" itemprop="url">rsyslog收集日志</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-30T14:33:53+08:00">
                2018-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>以日志服务器为10.44.85.15为例，日志源机器为10.44.85.16</p>
</blockquote>
<h1 id="1-在10-44-85-16上修改-etc-rsyslog-conf"><a href="#1-在10-44-85-16上修改-etc-rsyslog-conf" class="headerlink" title="1. 在10.44.85.16上修改/etc/rsyslog.conf"></a>1. 在10.44.85.16上修改/etc/rsyslog.conf</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ModLoad</span> imuxsock <span class="comment"># provides support for local system logging (e.g. via logger command)</span></span><br><span class="line"><span class="comment"># $ModLoad imjournal # provides access to the systemd journal</span></span><br><span class="line"></span><br><span class="line"> File to store the position <span class="keyword">in</span> the journal</span><br><span class="line"><span class="variable">$IMJournalStateFile</span> imjournal.state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### RULES ####</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log all kernel messages to the console.</span></span><br><span class="line"><span class="comment"># Logging much else clutters up the screen.</span></span><br><span class="line"><span class="comment">#kern.*                                                 /dev/console</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log anything (except mail) of level info or higher.</span></span><br><span class="line"><span class="comment"># Don't log private authentication messages!</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none                /var/<span class="built_in">log</span>/messages</span><br><span class="line"></span><br><span class="line"><span class="comment"># The authpriv file has restricted access.</span></span><br><span class="line">authpriv.*                                              /var/<span class="built_in">log</span>/secure</span><br><span class="line"></span><br><span class="line"><span class="comment"># Log all the mail messages in one place.</span></span><br><span class="line">mail.*                                                  -/var/<span class="built_in">log</span>/maillog</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Log cron stuff</span></span><br><span class="line">cron.*                                                  /var/<span class="built_in">log</span>/cron</span><br><span class="line"></span><br><span class="line"><span class="comment"># Everybody gets emergency messages</span></span><br><span class="line">*.emerg                                                 :omusrmsg:*</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save news errors of level crit and higher in a special file.</span></span><br><span class="line">uucp,news.crit                                          /var/<span class="built_in">log</span>/spooler</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save boot messages also to boot.log</span></span><br><span class="line">local7.*                                                /var/<span class="built_in">log</span>/boot.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将自定义服务日志发送至日志服务器</span></span><br><span class="line"><span class="variable">$ModLoad</span> imfile</span><br><span class="line"><span class="variable">$InputFilePollInterval</span> 10</span><br><span class="line"></span><br><span class="line"><span class="variable">$InputFileName</span>         /var/<span class="built_in">log</span>/webfront/webfront.log      <span class="comment">#要监控的日志文件路径</span></span><br><span class="line"><span class="variable">$InputFileTag</span>          webfront-info:                      <span class="comment"># 定义文件标签 ，注意最后是冒号：</span></span><br><span class="line"><span class="variable">$InputFileStateFile</span>    state-webfront-info                 <span class="comment">#定义状态文件</span></span><br><span class="line"><span class="variable">$InputRunFileMonitor</span>                                       <span class="comment">#激活读取，可以设置多组日志读取，每组结束时设置本参数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ### begin forwarding rule ###</span></span><br><span class="line"><span class="comment"># The statement between the begin ... end define a SINGLE forwarding</span></span><br><span class="line"><span class="comment"># rule. They belong together, do NOT split them. If you create multiple</span></span><br><span class="line"><span class="comment"># forwarding rules, duplicate the whole block!</span></span><br><span class="line"><span class="comment"># Remote Logging (we use TCP for reliable delivery)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># An on-disk queue is created for this action. If the remote host is</span></span><br><span class="line"><span class="comment"># down, messages are spooled to disk and sent when it is up again.</span></span><br><span class="line"><span class="comment">#$ActionQueueFileName fwdRule1 # unique name prefix for spool files</span></span><br><span class="line"><span class="comment">#$ActionQueueMaxDiskSpace 1g   # 1gb space limit (use as much as possible)</span></span><br><span class="line"><span class="comment">#$ActionQueueSaveOnShutdown on # save messages to disk on shutdown</span></span><br><span class="line"><span class="comment">#$ActionQueueType LinkedList   # run asynchronously</span></span><br><span class="line"><span class="comment">#$ActionResumeRetryCount -1    # infinite retries if host is down</span></span><br><span class="line"><span class="comment"># remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional</span></span><br><span class="line"><span class="comment">#*.* @@remote-host:514</span></span><br><span class="line">*.* @@10.44.85.15:514</span><br><span class="line"><span class="comment"># ### end of the forwarding rule ###</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>一般默认配置即为发送系统日志，可以不做修改，注意最后<br><em>.</em> @@remote-host:514 修改为目标日志服务器ip</p>
</blockquote>
<h1 id="2-重启rsyslog"><a href="#2-重启rsyslog" class="headerlink" title="2. 重启rsyslog"></a>2. 重启rsyslog</h1><p>方法1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/rsyslog restart <span class="comment">#修改配置文件后一定要重启rsyslog服务</span></span><br><span class="line"></span><br><span class="line">/etc/init.d/rsyslog status  <span class="comment">#可查看服务状态</span></span><br></pre></td></tr></table></figure>
<p>方法2：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service rsyslog restart <span class="comment">#修改配置文件后一定要重启rsyslog服务</span></span><br><span class="line"></span><br><span class="line">service rsyslog status  <span class="comment">#查看服务状态</span></span><br></pre></td></tr></table></figure></p>
<h1 id="3-在10-44-85-15上修改-etc-rsyslog-conf"><a href="#3-在10-44-85-15上修改-etc-rsyslog-conf" class="headerlink" title="3. 在10.44.85.15上修改/etc/rsyslog.conf"></a>3. 在10.44.85.15上修改/etc/rsyslog.conf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ModLoad imuxsock</span><br><span class="line">$ModLoad imjournal</span><br><span class="line">$ModLoad immark</span><br><span class="line">$ModLoad imudp</span><br><span class="line">$UDPServerRun 514</span><br><span class="line">$ModLoad imtcp</span><br><span class="line">$InputTCPServerRun 514</span><br><span class="line">$WorkDirectory /var/lib/rsyslog</span><br><span class="line">$AllowedSender tcp, 10.44.85.0/24</span><br><span class="line">$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat</span><br><span class="line">$template Remote,&quot;/var/log/%fromhost-ip%/%fromhost-ip%_%$YEAR%-%$MONTH%-%$DAY%.log&quot;</span><br><span class="line">:fromhost-ip, !isequal, &quot;127.0.0.1&quot; ?Remote</span><br><span class="line">$IncludeConfig /etc/rsyslog.d/*.conf</span><br><span class="line">$OmitLocalLogging on</span><br><span class="line">$IMJournalStateFile imjournal.state</span><br><span class="line"></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none	/var/log/rsyslog</span><br><span class="line">authpriv.*					/var/log/secure</span><br><span class="line">mail.*						-/var/log/maillog</span><br><span class="line">cron.*						/var/log/corn</span><br><span class="line">*.emerg						:omusrmsg:*</span><br><span class="line">uucp,news.crit					/var/log/spooler</span><br><span class="line">local7.*					/var/log/boot.log</span><br></pre></td></tr></table></figure>
<h1 id="4-重启rsyslog"><a href="#4-重启rsyslog" class="headerlink" title="4. 重启rsyslog"></a>4. 重启rsyslog</h1><p>方法1：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/rsyslog restart <span class="comment">#修改配置文件后一定要重启rsyslog服务</span></span><br><span class="line"></span><br><span class="line">/etc/init.d/rsyslog status  <span class="comment">#可查看服务状态</span></span><br></pre></td></tr></table></figure>
<p>方法2：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service rsyslog restart <span class="comment">#修改配置文件后一定要重启rsyslog服务</span></span><br><span class="line"></span><br><span class="line">service rsyslog status  <span class="comment">#查看服务状态</span></span><br></pre></td></tr></table></figure></p>
<h1 id="5-检验日志收集"><a href="#5-检验日志收集" class="headerlink" title="5. 检验日志收集"></a>5. 检验日志收集</h1><p>在日志服务器10.44.85.15上查看通过rsyslog收集的10.44.85.16的日志</p>
<p>日志路径：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /var/log/10.44.85.16/</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/30/mysql数据库密码安全策略/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/30/mysql数据库密码安全策略/" itemprop="url">mysql数据库密码安全策略</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-30T12:00:17+08:00">
                2018-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-安全审计要求"><a href="#1-安全审计要求" class="headerlink" title="1.安全审计要求"></a>1.安全审计要求</h1><p>由于安全审计要求，建议设置数据库密码复杂策略，启用密码复杂度验证函数，至少满足锁定时间大于3分钟，最长使用天数小于180天，可重用次数小于5次）；更改弱口令用户的密码，长度至少八位，由字母、数字或特殊字符混合组成，禁止用户名和口令相同</p>
<h1 id="2-mysql5-6-参考文档"><a href="#2-mysql5-6-参考文档" class="headerlink" title="2.mysql5.6 参考文档"></a>2.mysql5.6 参考文档</h1><p>连接限制:</p>
<p><a href="https://dev.mysql.com/doc/refman/5.6/en/connection-control.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.6/en/connection-control.html</a></p>
<p>密码复杂度设置：</p>
<p><a href="https://dev.mysql.com/doc/refman/5.6/en/validate-password.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.6/en/validate-password.html</a> </p>
<p>my.cnf文件说明：</p>
<p><a href="https://dev.mysql.com/doc/refman/5.6/en/option-files.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.6/en/option-files.html</a></p>
<p>可通过以下命令查看部分参数内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep mysql</span><br><span class="line"></span><br><span class="line">liuhui           15695   1.2  0.0  2443044    820 s000  S+   11:47上午   0:00.00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn mysql</span><br><span class="line">_mysql           96213   0.0  0.0  2831668   1364   ??  Ss   三02下午   0:10.16 /usr/<span class="built_in">local</span>/mysql/bin/mysqld --user=_mysql --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/usr/<span class="built_in">local</span>/mysql/data --plugin-dir=/usr/<span class="built_in">local</span>/mysql/lib/plugin --<span class="built_in">log</span>-error=/usr/<span class="built_in">local</span>/mysql/data/mysqld.local.err --pid-file=/usr/<span class="built_in">local</span>/mysql/data/mysqld.local.pid</span><br></pre></td></tr></table></figure>
<p>案例如下：</p>
<blockquote>
<p>注意可能有些配置在用户机器上不生效，导致mysql无法正常启动</p>
<p>此时注释掉相关报错参数，重启mysql</p>
<p>改为通过官网中命令形式进行设置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[liuhui@cloudwiz] $ vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">[base]</span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql</span><br><span class="line">datadir = /usr/<span class="built_in">local</span>/mysql/data</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line">log_error = /usr/<span class="built_in">local</span>/mysql/data/mysqld.local.err</span><br><span class="line">pid-file = /usr/<span class="built_in">local</span>/mysql/data/mysqld.local.pid</span><br><span class="line">user = mysql</span><br><span class="line"></span><br><span class="line">sql_mode = NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment"># localhost work, but costumer's host dosen't work, and I don't know why</span></span><br><span class="line">default_password_lifetime = 180</span><br><span class="line"></span><br><span class="line"><span class="comment"># load plugin of validate_password.so</span></span><br><span class="line">plugin-load=validate_password.so</span><br><span class="line">validate_password_length = 8</span><br><span class="line">validate_password_policy = 1</span><br><span class="line">validate-password=FORCE_PLUS_PERMANENT</span><br><span class="line"></span><br><span class="line"><span class="comment"># load plugin of connetion_control.so</span></span><br><span class="line"> plugin-load-add = connection_control.so</span><br><span class="line"><span class="comment"># force enable plugin</span></span><br><span class="line"><span class="comment"># connection-control = FORCE_PLUS_PREMANENT</span></span><br><span class="line"><span class="comment"># connection-control-failed-login-attempts = FORCE_PLUS_PREMANENT</span></span><br><span class="line"><span class="comment"># connection_control_failed_connections_threshold = 3</span></span><br><span class="line"><span class="comment"># connection_control_max_connection_delay = 2147483647</span></span><br><span class="line"><span class="comment"># connection_control_min_connection_delay = 10000</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h1 id="3-mysql-5-6-与-5-7的区别"><a href="#3-mysql-5-6-与-5-7的区别" class="headerlink" title="3.mysql 5.6 与 5.7的区别"></a>3.mysql 5.6 与 5.7的区别</h1><p>mysql5.6的不会对之前创建的用户造成影响，不改密码也OK</p>
<p>mysql5.7的会检测之前的用户，如果密码强度不够，会强制要求修改密码</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/19/nmap命令-基础用法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/19/nmap命令-基础用法/" itemprop="url">nmap命令--基础用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-19T17:34:35+08:00">
                2018-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>文章来源: <a href="https://www.cnblogs.com/nmap/p/6232207.html" target="_blank" rel="noopener">nmap命令—–基础用法</a></p>
<p>系统漏洞扫描之王-nmap</p>
<p>NMap，也就是Network Mapper，是Linux下的网络扫描和嗅探工具包。</p>
<p>其基本功能有三个：</p>
<p>（1）是扫描主机端口，嗅探所提供的网络服务</p>
<p>（2）是探测一组主机是否在线</p>
<p>（3）还可以推断主机所用的操作系统，到达主机经过的路由，系统已开放端口的软件版本</p>
<blockquote>
<p>nmap端口状态解析<br>open ： 应用程序在该端口接收 TCP 连接或者 UDP 报文。<br>closed ：关闭的端口对于nmap也是可访问的， 它接收nmap探测报文并作出响应。但没有应用程序在其上监听。<br>filtered ：由于包过滤阻止探测报文到达端口，nmap无法确定该端口是否开放。过滤可能来自专业的防火墙设备，路由规则 或者主机上的软件防火墙。<br>unfiltered ：未被过滤状态意味着端口可访问，但是nmap无法确定它是开放还是关闭。 只有用于映射防火墙规则集的 ACK 扫描才会把端口分类到这个状态。<br>open | filtered ：无法确定端口是开放还是被过滤， 开放的端口不响应就是一个例子。没有响应也可能意味着报文过滤器丢弃了探测报文或者它引发的任何反应。UDP，IP协议,FIN, Null 等扫描会引起。<br>closed|filtered：（关闭或者被过滤的）：无法确定端口是关闭的还是被过滤的</p>
</blockquote>
<p>nmap有windows和linux</p>
<p>Nmap是一款网络扫描和主机检测的非常有用的工具。Nmap是不局限于仅仅收集信息和枚举，同时可以用来作为一个漏洞探测器或安全扫描器。它可以适用于winodws,linux,mac等操作系统<br>从下面官网可以下载exe程序包和zip包<br><a href="https://nmap.org/download.html#windows" target="_blank" rel="noopener">https://nmap.org/download.html#windows</a></p>
<p>nmap常用参数</p>
<p>nmap扫描速度要比nc快</p>
<p>面是一些基本的命令和它们的用法的例子：扫描单一的一个主机，命令如下：</p>
<h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><p>准备两台机器</p>
<p>主机A：ip地址 10.0.1.161</p>
<p>主机B：ip地址 10.0.1.162</p>
<p>B机器安装nmap的包（这个工具比较强大，习惯上每台机器都安装）<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nmap -y</span><br></pre></td></tr></table></figure></p>
<h2 id="端口扫描部分"><a href="#端口扫描部分" class="headerlink" title="端口扫描部分"></a>端口扫描部分</h2><h3 id="前期准备-1"><a href="#前期准备-1" class="headerlink" title="前期准备"></a>前期准备</h3><p>B机器使用nmap去扫描A机器，扫描之前，A机器先查看自己上面有哪些端口在被占用</p>
<p>A机器上查看本地ipv4的监听端口</p>
<blockquote>
<p>netstat参数解释：<br>-l  (listen) 仅列出 Listen (监听) 的服务<br>-t  (tcp) 仅显示tcp相关内容<br>-n (numeric) 直接显示ip地址以及端口，不解析为服务名或者主机名<br>-p (pid) 显示出socket所属的进程PID 以及进程名字<br>–inet 显示ipv4相关协议的监听</p>
</blockquote>
<p>查看IPV4端口上的tcp的监听</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@A ~] netstat -lntp --inet</span><br><span class="line"></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name  </span><br><span class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      2157/sshd          </span><br><span class="line">tcp        0      0 127.0.0.1:631               0.0.0.0:*                   LISTEN      1930/cupsd         </span><br><span class="line">tcp        0      0 127.0.0.1:25                0.0.0.0:*                   LISTEN      2365/master        </span><br><span class="line">tcp        0      0 0.0.0.0:13306               0.0.0.0:*                   LISTEN      21699/mysqld       </span><br><span class="line">tcp        0      0 0.0.0.0:873                 0.0.0.0:*                   LISTEN      2640/rsync         </span><br><span class="line">tcp        0      0 0.0.0.0:111                 0.0.0.0:*                   LISTEN      21505/rpcbind</span><br></pre></td></tr></table></figure>
<p>过滤掉监控在127.0.0.1的端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@A ~] netstat   -lntp    --inet | grep -v 127.0.0.1</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name  </span><br><span class="line">tcp        0      0 0.0.0.0:22                  0.0.0.0:*                   LISTEN      2157/sshd          </span><br><span class="line">tcp        0      0 0.0.0.0:13306               0.0.0.0:*                   LISTEN      21699/mysqld       </span><br><span class="line">tcp        0      0 0.0.0.0:873                 0.0.0.0:*                   LISTEN      2640/rsync         </span><br><span class="line">tcp        0      0 0.0.0.0:111                 0.0.0.0:*                   LISTEN      21505/rpcbind</span><br></pre></td></tr></table></figure>
<h3 id="扫描tcp端口"><a href="#扫描tcp端口" class="headerlink" title="扫描tcp端口"></a>扫描tcp端口</h3><p>B机器上使用nmap扫描A机器所有端口（-p后面也可以跟空格）</p>
<p>下面表示扫描A机器的1到65535所有在监听的tcp端口。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 10.0.1.161  -p1-65535</span><br></pre></td></tr></table></figure></p>
<p>指定端口范围使用-p参数，如果不指定要扫描的端口，Nmap默认扫描从1到1024再加上nmap-services列出的端口<br>nmap-services是一个包含大约2200个著名的服务的数据库，Nmap通过查询该数据库可以报告那些端口可能对应于什么服务器，但不一定正确。<br>所以正确扫描一个机器开放端口的方法是上面命令。-p1-65535<br>注意，nmap有自己的库，存放一些已知的服务和对应端口号，假如有的服务不在nmap-services，可能nmap就不会去扫描，这就是明明一些端口已经是处于监听状态，nmap默认没扫描出来的原因，需要加入-p参数让其扫描所有端口。<br>虽然直接使用nmap 10.0.1.161也可以扫描出开放的端口，但是使用-p1-65535 能显示出最多的端口<br>区别在于不加-p 时，显示的都是已知协议的端口，对于未知协议的端口没显示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap  10.0.1.161  -p1-65535</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:11 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.00017s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">22/tcp    open  ssh</span><br><span class="line">111/tcp   open  rpcbind</span><br><span class="line">873/tcp   open  rsync</span><br><span class="line">13306/tcp open  unknown</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 2.49 seconds</span><br></pre></td></tr></table></figure>
<p>如果不加-p1-65535，对于未知服务的端口（A机器的13306端口）就没法扫描到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap  10.0.1.161</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:12 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.000089s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line">873/tcp open  rsync</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.43 seconds</span><br></pre></td></tr></table></figure>
<p>扫描一个IP的多个端口</p>
<p>连续的端口可以使用横线连起来，端口之间可以使用逗号隔开</p>
<p>A机器上再启动两个tcp的监听，分别占用7777和8888端口，用于测试，加入&amp;符号可以放入后台</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@A ~] nc -l 7777&amp;</span><br><span class="line">[1] 21779</span><br><span class="line">[root@A ~] nc -l 8888&amp;</span><br><span class="line">[2] 21780</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap  10.0.1.161   -p20-200,7777,8888</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:32 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.00038s latency).</span><br><span class="line">Not shown: 179 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">111/tcp  open  rpcbind</span><br><span class="line">7777/tcp open  cbt</span><br><span class="line">8888/tcp open  sun-answerbook</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.17 seconds</span><br></pre></td></tr></table></figure>
<h3 id="扫描udp端口"><a href="#扫描udp端口" class="headerlink" title="扫描udp端口"></a>扫描udp端口</h3><p>先查看哪些ipv4的监听，使用grep -v排除回环接口上的监听</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@A ~] netstat -lnup --inet |grep -v 127.0.0.1</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State       PID/Program name  </span><br><span class="line">udp        0      0 0.0.0.0:111                 0.0.0.0:*                               21505/rpcbind      </span><br><span class="line">udp        0      0 0.0.0.0:631                 0.0.0.0:*                               1930/cupsd         </span><br><span class="line">udp        0      0 10.0.1.161:123              0.0.0.0:*                               2261/ntpd          </span><br><span class="line">udp        0      0 0.0.0.0:123                 0.0.0.0:*                               2261/ntpd          </span><br><span class="line">udp        0      0 0.0.0.0:904                 0.0.0.0:*                               21505/rpcbind</span><br></pre></td></tr></table></figure>
<blockquote>
<p>-sU：表示udp scan ， udp端口扫描<br>-Pn：不对目标进行ping探测（不判断主机是否在线）（直接扫描端口）<br>对于udp端口扫描比较慢，扫描完6万多个端口需要20分钟左右</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap  -sU  10.0.1.161  -Pn</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:16 CST</span><br><span class="line">Stats: 0:12:54 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan</span><br><span class="line">UDP Scan Timing: About 75.19% <span class="keyword">done</span>; ETC: 10:33 (0:04:16 remaining)</span><br><span class="line">Stats: 0:12:55 elapsed; 0 hosts completed (1 up), 1 undergoing UDP Scan</span><br><span class="line">UDP Scan Timing: About 75.29% <span class="keyword">done</span>; ETC: 10:33 (0:04:15 remaining)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE         SERVICE</span><br><span class="line">111/udp open          rpcbind</span><br><span class="line">123/udp open          ntp</span><br><span class="line">631/udp open|filtered ipp</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 1081.27 seconds</span><br></pre></td></tr></table></figure>
<h3 id="扫描多个IP用法"><a href="#扫描多个IP用法" class="headerlink" title="扫描多个IP用法"></a>扫描多个IP用法</h3><p>中间用空格分开<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap 10.0.1.161  10.0.1.162</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:18 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.000060s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line">873/tcp open  rsync</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.162</span><br><span class="line">Host is up (0.0000070s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 2 IP addresses (2 hosts up) scanned <span class="keyword">in</span> 0.26 seconds</span><br></pre></td></tr></table></figure></p>
<p>也可以采用下面方式逗号隔开</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap 10.0.1.161,162</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:19 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.00025s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line">873/tcp open  rsync</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.162</span><br><span class="line">Host is up (0.0000080s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 2 IP addresses (2 hosts up) scanned <span class="keyword">in</span> 0.81 seconds</span><br></pre></td></tr></table></figure>
<h3 id="扫描连续的ip地址"><a href="#扫描连续的ip地址" class="headerlink" title="扫描连续的ip地址"></a>扫描连续的ip地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap 10.0.1.161-162</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:20 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.00011s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line">873/tcp open  rsync</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.162</span><br><span class="line">Host is up (0.0000030s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 2 IP addresses (2 hosts up) scanned <span class="keyword">in</span> 0.25 seconds</span><br></pre></td></tr></table></figure>
<h3 id="扫描一个子网网段所有IP"><a href="#扫描一个子网网段所有IP" class="headerlink" title="扫描一个子网网段所有IP"></a>扫描一个子网网段所有IP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap  10.0.3.0/24</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:21 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.3.1</span><br><span class="line">Host is up (0.020s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">23/tcp   open  telnet</span><br><span class="line">6666/tcp open  irc</span><br><span class="line">8888/tcp open  sun-answerbook</span><br><span class="line"> </span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.3.2</span><br><span class="line">Host is up (0.012s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE    SERVICE</span><br><span class="line">21/tcp filtered ftp</span><br><span class="line">22/tcp filtered ssh</span><br><span class="line">23/tcp open     telnet</span><br><span class="line"> </span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.3.3</span><br><span class="line">Host is up (0.018s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE    SERVICE</span><br><span class="line">21/tcp filtered ftp</span><br><span class="line">22/tcp filtered ssh</span><br><span class="line">23/tcp open     telnet</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 256 IP addresses (3 hosts up) scanned <span class="keyword">in</span> 14.91 seconds</span><br></pre></td></tr></table></figure>
<h3 id="扫描文件里的IP"><a href="#扫描文件里的IP" class="headerlink" title="扫描文件里的IP"></a>扫描文件里的IP</h3><p>如果你有一个ip地址列表，将这个保存为一个txt文件，和namp在同一目录下,扫描这个txt内的所有主机，用法如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] cat ip.txt</span><br><span class="line">10.0.1.161</span><br><span class="line">10.0.1.162</span><br><span class="line">[root@B ~] nmap -iL ip.txt</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:23 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.00030s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line">873/tcp open  rsync</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.162</span><br><span class="line">Host is up (0.0000070s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 2 IP addresses (2 hosts up) scanned <span class="keyword">in</span> 0.68 seconds</span><br></pre></td></tr></table></figure></p>
<h3 id="扫描地址段是排除某个IP地址"><a href="#扫描地址段是排除某个IP地址" class="headerlink" title="扫描地址段是排除某个IP地址"></a>扫描地址段是排除某个IP地址</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap 10.0.1.161-162  --exclude 10.0.1.162</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:24 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.0022s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line">873/tcp open  rsync</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.53 seconds</span><br></pre></td></tr></table></figure>
<h3 id="扫描时排除多个IP地址"><a href="#扫描时排除多个IP地址" class="headerlink" title="扫描时排除多个IP地址"></a>扫描时排除多个IP地址</h3><p>排除连续的，可以使用横线连接起来<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap 10.0.1.161-163   --exclude 10.0.1.162-163</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:25 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.161</span><br><span class="line">Host is up (0.00023s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line">873/tcp open  rsync</span><br><span class="line">MAC Address: 00:0C:29:56:DE:46 (VMware)</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.56 seconds</span><br></pre></td></tr></table></figure></p>
<p>　　<br>排除分散的，使用逗号隔开<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] nmap 10.0.1.161-163 --exclude 10.0.1.161,10.0.1.163</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:27 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.162</span><br><span class="line">Host is up (0.0000030s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.12 seconds</span><br></pre></td></tr></table></figure></p>
<p>扫描多个地址时排除文件里的IP地址（可以用来排除不连续的IP地址）<br>把10.0.1.161和10.0.1.163添加到一个文件里，文件名可以随意取<br>下面扫描10.0.1.161到10.0.1.163 这3个IP地址，排除10.0.1.161和10.0.1.163这两个IP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@B ~] cat ex.txt</span><br><span class="line">10.0.1.161</span><br><span class="line">10.0.1.163</span><br><span class="line">[root@B ~] nmap 10.0.1.161-163  --excludefile ex.txt</span><br><span class="line"> </span><br><span class="line">Starting Nmap 5.51 ( http://nmap.org ) at 2016-12-29 10:29 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.0.1.162</span><br><span class="line">Host is up (0.0000050s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22/tcp  open  ssh</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line"> </span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.18 seconds</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/19/设置Linux用户连续N次输入错误密码进行登陆时，自动锁定X秒/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/19/设置Linux用户连续N次输入错误密码进行登陆时，自动锁定X秒/" itemprop="url">设置Linux用户连续N次输入错误密码进行登陆时，自动锁定X秒</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-19T14:15:00+08:00">
                2018-11-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>文章来源：<a href="https://blog.csdn.net/m0_37886429/article/details/79641551" target="_blank" rel="noopener">设置Linux用户连续N次输入错误密码进行登陆时，自动锁定X秒</a></p>
<p>一、在字符终端下，实现某一用户连续错误登陆N次后，就锁定该用户X分钟(pam_tally2)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/pam.d/login</span><br><span class="line"><span class="comment"># 在#%PAM-1.0 下新起一行，加入</span></span><br><span class="line">auth required pam_tally2.so deny=3 unlock_time=5 even_deny_root root_unlock_time=10</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不限制root用户，则可以写成</span></span><br><span class="line">auth required pam_tally2.so deny=3 unlock_time=5</span><br><span class="line"></span><br><span class="line">even_deny_root    <span class="comment">#也限制root用户；</span></span><br><span class="line">deny              <span class="comment"># 设置普通用户和root用户连续错误登陆的最大次数，超过最大次数，则锁定该用户；</span></span><br><span class="line">unlock_time       <span class="comment">#设定普通用户锁定后，多少时间后解锁，单位是秒；</span></span><br><span class="line">root_unlock_time  <span class="comment">#设定root用户锁定后，多少时间后解锁，单位是秒；</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>备注： </p>
<p>1、此处使用的是 pam_tally2 模块，如果不支持 pam_tally2 模块可以使用 pam_tally 模块。另外，不同的pam版本，设置可能有所不同，具体使用方法，可以参照相关模块的使用规则。 </p>
<p>2、也可以直接在 system-auth 文件中直接添加这些命令，修改完成后，凡是调用 system-auth 文件的服务，都会生效。因为有自动解锁时间，所以，不用担心全部限制后，会出现永远无法登陆的”尴尬”情况。 </p>
<p>3、可以使用 pam_tally2 -r -u username 命令，手动清除某用户记录次数。</p>
</blockquote>
<p>二、设置Linux用户连续N次登陆失败时，自动锁定X分钟(pam_tally) </p>
<p>1、如果想在所有登陆方式上，限制所有用户，可以在 /etc/pam.d/system-auth 中增加2行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auth  required  pam_tally.so  onerr=fail  no_magic_root</span><br><span class="line">account  required  pam_tally.so   deny=3  no_magic_root  even_deny_root_account  per_user  reset</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>deny   设置普通用户和root用户连续错误登陆的最大次数，超过最大次数，则锁定该用户；<br>no_magic_root  连root用户也在限制范围，不给root特殊权限。<br>详细参数的含义，参见 /usr/share/doc/pam-xxxx/txts/README.pam_tally<br>如果不想限制root用户，可以将 even_deny_root_account 取消掉。</p>
</blockquote>
<p>2、针对不同服务来限制不同登陆方式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#只在本地文本终端上做限制，可以编辑如下文件，添加的内容和上方一样。</span></span><br><span class="line">vim /etc/pam.d/login</span><br><span class="line"></span><br><span class="line"><span class="comment">#只在远程telnet、ssh登陆上做限制，可以编辑如下文件，添加的内容和上方也一样。</span></span><br><span class="line">vim /etc/pam.d/remote</span><br><span class="line">vim /etc/pam.d/sshd</span><br></pre></td></tr></table></figure></p>
<p>3、手动解除锁定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看某一用户错误登陆次数：</span></span><br><span class="line">pam_tally –user username</span><br><span class="line"><span class="comment">#例如，查看work用户的错误登陆次数：</span></span><br><span class="line">pam_tally –user work</span><br><span class="line"></span><br><span class="line"><span class="comment">#清空某一用户错误登陆次数：</span></span><br><span class="line">pam_tally –user username –reset</span><br><span class="line"><span class="comment">#例如，清空 work 用户的错误登陆次数，</span></span><br><span class="line">pam_tally –user work –reset</span><br><span class="line"></span><br><span class="line">faillog -r 命令亦可。</span><br></pre></td></tr></table></figure>
<p>4、pam_tally没有自动解锁功能</p>
<blockquote>
<p>因为pam_tally没有自动解锁的功能，所以，在设置限制时，要多加注意，万一全做了限制，而 root用户又被锁定了，就只能够进单用户模式解锁了，当然，也可以添加crontab任务，达到定时自动解锁的功能，但需要注意的是，如果在/etc /pam.d/system-auth 文件中添加了pam_tally的话，当root被锁定后，crontab任务会失效，所以，最好不要在system-auth 文件中添加pam_tally。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/12/14/centos6添加node系统server/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/14/centos6添加node系统server/" itemprop="url">centos6添加node系统server</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-14T20:35:39+08:00">
                2017-12-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>文章来源: <a href="http://www.alliedjeep.com/127869.htm" target="_blank" rel="noopener">CentOS5.6下离线部署NodeJS环境和工程代码，并添加forever的开机自启动服务</a></p>
<h1 id="1-centos6-启动-关闭服务"><a href="#1-centos6-启动-关闭服务" class="headerlink" title="1. centos6 启动/关闭服务"></a>1. centos6 启动/关闭服务</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service server start/stop/restart</span><br></pre></td></tr></table></figure>
<h1 id="2-添加node-server"><a href="#2-添加node-server" class="headerlink" title="2. 添加node server"></a>2. 添加node server</h1><p>这段脚本含义有心情再补充了。。。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sdu_server 是为自定义服务起的名字,可任意</span></span><br><span class="line">vim /etc/init.d/sdu_server</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># chkconfig:345 99 01 这一串不知道干嘛</span></span><br><span class="line"><span class="comment"># description: 图书查询服务</span></span><br><span class="line"><span class="comment"># 启动服务的脚本路径 /opt/project/sdulibrary/library_db</span></span><br><span class="line"><span class="comment"># 使用node forever 管理node server</span></span><br><span class="line">DIR=<span class="string">'/opt/project/sdulibrary/library_db'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> start_app &#123;</span><br><span class="line">  forever start -a <span class="string">"<span class="variable">$DIR</span>/getlist.js"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> stop_app &#123;</span><br><span class="line">  forever stop <span class="string">"<span class="variable">$DIR</span>/getlist.js"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">  start)</span><br><span class="line">    start_app ;;</span><br><span class="line">  stop)</span><br><span class="line">    stop_app ;;</span><br><span class="line">  restart)</span><br><span class="line">    stop_app</span><br><span class="line">    start_app</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"usage: clearstonecc &#123;start|stop&#125;"</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure></p>
<h1 id="3-启动自定义服务"><a href="#3-启动自定义服务" class="headerlink" title="3. 启动自定义服务"></a>3. 启动自定义服务</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service sdu_server start</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/30/centos7-nginx-php/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/30/centos7-nginx-php/" itemprop="url">centos7-nginx-php</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-30T23:08:13+08:00">
                2017-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-系统环境"><a href="#1-系统环境" class="headerlink" title="1.系统环境"></a>1.系统环境</h1><p>阿里云服务器 centos7</p>
<p>nginx version: nginx/1.12.2</p>
<h1 id="2-一键php"><a href="#2-一键php" class="headerlink" title="2.一键php"></a>2.一键php</h1><p>安装并验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y php</span><br><span class="line"></span><br><span class="line">php -v</span><br></pre></td></tr></table></figure>
<p>显示以下内容则安装成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PHP 5.4.16 (cli) (built: Nov 15 2017 16:33:54)</span><br><span class="line">Copyright (c) 1997-2013 The PHP Group</span><br><span class="line">Zend Engine v2.4.0, Copyright (c) 1998-2013 Zend Technologies</span><br></pre></td></tr></table></figure></p>
<p>启动php–很重要,被这个命令卡了一晚上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start php-fpm</span><br></pre></td></tr></table></figure>
<p>验证是否成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@liuhuiiris php_wx]<span class="comment"># ps -ef | grep php-fpm</span></span><br><span class="line"></span><br><span class="line">root     31847     1  0 23:02 ?        00:00:00 php-fpm: master process (/etc/php-fpm.conf)</span><br><span class="line">apache   31849 31847  0 23:02 ?        00:00:00 php-fpm: pool www</span><br><span class="line">apache   31850 31847  0 23:02 ?        00:00:00 php-fpm: pool www</span><br><span class="line">apache   31851 31847  0 23:02 ?        00:00:00 php-fpm: pool www</span><br><span class="line">apache   31852 31847  0 23:02 ?        00:00:00 php-fpm: pool www</span><br><span class="line">apache   31853 31847  0 23:02 ?        00:00:00 php-fpm: pool www</span><br><span class="line">root     31855 31234  0 23:02 pts/1    00:00:00 grep --color=auto php-fpm</span><br></pre></td></tr></table></figure></p>
<h1 id="3-配置nginx"><a href="#3-配置nginx" class="headerlink" title="3. 配置nginx"></a>3. 配置nginx</h1><p>配置好相应路径即可，127.0.0.1:9000不要擅自修改<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    root   /opt/workspace/php_wx;</span><br><span class="line">    index  index.html index.htm index.php;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">    <span class="comment">#root           /opt/workspace/php_wx;</span></span><br><span class="line">    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">    fastcgi_index  index.php;</span><br><span class="line">    fastcgi_param  SCRIPT_FILENAME  /opt/workspace/php_wx<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    include        fastcgi_params;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置好nginx后reload<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure></p>
<p>测试php<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/workspace/php_wx/info.php</span><br><span class="line"></span><br><span class="line">&lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></figure></p>
<p>在浏览器中打开 IP/info.php,如下图所示<br><img src="https://liuhuiiris.github.io/img/php/php.png" alt="php"></p>
<p>大功告成！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/30/linux-软链接-硬链接/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/30/linux-软链接-硬链接/" itemprop="url">linux 软链接|硬链接</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-30T21:28:33+08:00">
                2017-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考文章: <a href="http://www.jianshu.com/p/05384fc68048?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation" target="_blank" rel="noopener">Linux 系统结构详解</a></p>
<p>文章来源: 百度百科</p>
<h1 id="1-软链接"><a href="#1-软链接" class="headerlink" title="1.软链接"></a>1.软链接</h1><p>软链接又叫符号链接，这个文件包含了另一个文件的路径名。可以是任意文件或目录，可以链接不同文件系统的文件。<br>链接文件甚至可以链接不存在的文件，这就产生一般称之为”断链”的现象，链接文件甚至可以循环链接自己。类似于编程语言中的递归。<br>软链接文件只是其源文件的一个标记，当删除了源文件后，链接文件不能独立存在，虽然仍保留文件名，但却不能查看软链接文件的内容了。</p>
<h1 id="2-软链接使用方法"><a href="#2-软链接使用方法" class="headerlink" title="2.软链接使用方法"></a>2.软链接使用方法</h1><p>生成软链接<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s source_file softlink_file</span><br></pre></td></tr></table></figure></p>
<p>在对符号文件进行读或写操作的时候，系统会自动把该操作转换为对源文件的操作，但删除链接文件时，系统仅仅删除链接文件，而不删除源文件本身。</p>
<p>删除硬/软链接用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm softlink_file</span><br></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlink softlink_file</span><br></pre></td></tr></table></figure></p>
<h1 id="3-硬链接"><a href="#3-硬链接" class="headerlink" title="3.硬链接"></a>3.硬链接</h1><p>硬链接(hard link, 也称链接)就是一个文件的一个或多个文件名。再说白点，所谓链接无非是把文件名和计算机文件系统使用的节点号链接起来。因此我们可以用多个文件名与同一个文件进行链接，这些文件名可以在同一目录或不同目录。</p>
<p>硬链接只能引用同一文件系统中的文件。它引用的是文件在文件系统中的物理索引(也称为 inode)。当您移动或删除原始文件时，硬链接不会被破坏，因为它所引用的是文件的物理数据而不是文件在文件结构中的位置。硬链接的文件不需要用户有访问原始文件的权限，也不会显示原始文件的位置，这样有助于文件的安全。如果您删除的文件有相应的硬链接，那么这个文件依然会保留，直到所有对它的引用都被删除。</p>
<h1 id="4-硬链接使用方法"><a href="#4-硬链接使用方法" class="headerlink" title="4.硬链接使用方法"></a>4.硬链接使用方法</h1><p>生成硬链接<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln source_file softlink_file</span><br></pre></td></tr></table></figure></p>
<p>注意事项：</p>
<p>1、修改源文件或者目标文件, 对应另外一个文件也会发生相应修改.</p>
<p>2、删除源文件或者目标文件, 对另外一个文件没有影响.</p>
<p>3、硬链接文件不占用存储空间.</p>
<p>4、不能对目录文件进行创建硬链接操作.</p>
<p>5、硬链接文件不能跨文件系统.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/29/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/29/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-29T22:24:18+08:00">
                2017-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/11/29/海外服务器搭建小梯子/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Hui Liu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/avatar/1.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="liuhuiIris">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/11/29/海外服务器搭建小梯子/" itemprop="url">海外服务器搭建小梯子</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-29T21:10:33+08:00">
                2017-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>文章来源: <a href="http://morning.work/page/2015-12/install-shadowsocks-on-centos-7.html" target="_blank" rel="noopener">老雷</a></p>
<h1 id="1、安装客户端"><a href="#1、安装客户端" class="headerlink" title="1、安装客户端"></a>1、安装客户端</h1><p><a href="www.rbq.buzz">sibyl云加速</a>下载各种版本的shadowsocks</p>
<h1 id="2、Centos7搭建shadowsocks服务器"><a href="#2、Centos7搭建shadowsocks服务器" class="headerlink" title="2、Centos7搭建shadowsocks服务器"></a>2、Centos7搭建shadowsocks服务器</h1><p>CentOS 7 开始默认使用Systemd作为开启启动脚本的管理工具，Shadowsocks则是当前比较受欢迎的科学上网工具，本文将介绍如何在 CentOS 下安装和配置 Shadowsocks 服务。</p>
<h2 id="2-1-安装pip"><a href="#2-1-安装pip" class="headerlink" title="2.1 安装pip"></a>2.1 安装pip</h2><p>pip是 python 的包管理工具。在本文中将使用 python 版本的 shadowsocks，此版本的 shadowsocks 已发布到 pip 上，因此我们需要通过 pip 命令来安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">"https://bootstrap.pypa.io/get-pip.py"</span> -o <span class="string">"get-pip.py"</span></span><br><span class="line">python get-pip.py</span><br></pre></td></tr></table></figure>
<h2 id="2-2-安装配置-shadowsocks"><a href="#2-2-安装配置-shadowsocks" class="headerlink" title="2.2 安装配置 shadowsocks"></a>2.2 安装配置 shadowsocks</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade pip</span><br><span class="line">pip install shadowsocks</span><br></pre></td></tr></table></figure>
<h2 id="2-3-配置shadowsocks-json文件"><a href="#2-3-配置shadowsocks-json文件" class="headerlink" title="2.3 配置shadowsocks.json文件"></a>2.3 配置shadowsocks.json文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/shadowsocks.json</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"server"</span>        : <span class="string">"0.0.0.0"</span>,</span><br><span class="line">	<span class="string">"server_port"</span>   : 443,</span><br><span class="line">	<span class="string">"local_address"</span> : <span class="string">"127.0.0.1"</span>,</span><br><span class="line">	<span class="string">"local_port"</span>    : 1080,</span><br><span class="line">	<span class="string">"password"</span>      : <span class="string">"your password"</span>,</span><br><span class="line">	<span class="string">"timeout"</span>       : 300,</span><br><span class="line">	<span class="string">"method"</span>        : <span class="string">"rc4-md5"</span>,</span><br><span class="line">	<span class="string">"fast_open"</span>     : <span class="literal">false</span>,</span><br><span class="line">	<span class="string">"workers"</span>       : 5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<p>method为加密方法，可选aes-128-cfb, aes-192-cfb, aes-256-cfb, bf-cfb, cast5-cfb, des-cfb, rc4-md5, chacha20, salsa20, rc4, table<br>server_port为服务监听端口<br>password为密码，可使用密码生成工具生成一个随机密码<br>以上三项信息在配置 shadowsocks 客户端时需要配置一致，具体说明可查看 shadowsocks 的帮助文档。</p>
<h2 id="2-4-启动"><a href="#2-4-启动" class="headerlink" title="2.4 启动"></a>2.4 启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动</span></span><br><span class="line">ssserver -c /etc/shadowsocks.json -d start</span><br><span class="line"><span class="comment">#停止</span></span><br><span class="line">ssserver -c /etc/shadowsocks.json -d stop</span><br><span class="line"><span class="comment">#重启</span></span><br><span class="line">ssserver -c /etc/shadowsocks.json -d restart</span><br></pre></td></tr></table></figure>
<h1 id="3-客户端配置启动"><a href="#3-客户端配置启动" class="headerlink" title="3.客户端配置启动"></a>3.客户端配置启动</h1><p><img src="https://liuhuiiris.github.io/img/shadowsocks/shadowsocks.png" alt="shadowsocks"></p>
<h1 id="4-连接失败问题"><a href="#4-连接失败问题" class="headerlink" title="4.连接失败问题"></a>4.连接失败问题</h1><h2 id="4-1-服务器未开放443端口-一般是防火墙原因"><a href="#4-1-服务器未开放443端口-一般是防火墙原因" class="headerlink" title="4.1 服务器未开放443端口,一般是防火墙原因"></a>4.1 服务器未开放443端口,一般是防火墙原因</h2><blockquote>
<p>亦可通过管理端页面配置端口权限</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动防火墙</span></span><br><span class="line">$ systemctl start firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若报错 Failed to start firewalld.service: Unit firewalld.service is masked.先执行以下命令</span></span><br><span class="line">$ systemctl unmask firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开放443端口</span></span><br><span class="line">$ firewall-cmd --zone=public --add-port=443/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启防火墙</span></span><br><span class="line">$ firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参数说明：<br>–zone #作用域<br>–add-port=80/tcp #添加端口，格式为：端口/通讯协议<br>–permanent #代表永久生效，没有此参数重启后失效</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/img/avatar/1.png"
                alt="Hui Liu" />
            
              <p class="site-author-name" itemprop="name">Hui Liu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/liuhuiIris" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:liuhuiiris@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/liuhuiiris" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hui Liu</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
